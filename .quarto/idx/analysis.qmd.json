{"title":"Analysis","markdown":{"headingText":"Analysis","headingAttr":{"id":"","classes":["unnumbered"],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r setup r and sql, echo=FALSE}\n#| warning: false\n#| echo: false\nlibrary(readr)\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(gt)\nlibrary(DBI)\nlibrary(duckdb)\noptions(duckdb.enable_rstudio_connection_pane=TRUE)\n\ndrv <- duckdb()\ncon <- dbConnect(drv)\nlibrary(reticulate)\n# py_install(\"pandas\")\n# py_install(\"matplotlib\")\n```\n\n```{python setup python, echo=FALSE, results=FALSE}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport great_tables as gt\nimport warnings\nfrom great_tables import GT\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n```\n\n```{r, include=FALSE}\nspotify_cleaned <- readRDS(\"working_tables/spotify_cleaned.rds\")\ntiktok_cleaned <- readRDS(\"working_tables/tiktok_cleaned.rds\")\nbillboard_cleaned <- readRDS(\"working_tables/billboard_cleaned.rds\")\ncombined_cleaned <- readRDS(\"working_tables/combined_cleaned.rds\")\n```\n\n```{sql, include=FALSE}\n#| connection: con\nCREATE OR REPLACE TABLE spotify_cleaned AS\n  SELECT * FROM 'working_tables/spotify_cleaned_sql.csv';\nCREATE OR REPLACE TABLE tiktok_cleaned AS\n  SELECT * FROM 'working_tables/tiktok_cleaned_sql.csv';\nCREATE OR REPLACE TABLE billboard_cleaned AS\n  SELECT * FROM 'working_tables/billboard_cleaned_sql.csv';\nCREATE OR REPLACE TABLE combined_cleaned AS\n  SELECT * FROM 'working_tables/combined_cleaned_sql.csv';\n```\n\n```{python, include=FALSE}\nspotify_cleaned = pd.read_csv(\"working_tables/spotify_cleaned_py.csv\")\ntiktok_cleaned = pd.read_csv(\"working_tables/tiktok_cleaned_py.csv\")\nbillboard_cleaned = pd.read_csv(\"working_tables/billboard_cleaned_py.csv\")\ncombined = pd.read_csv(\"working_tables/combined_py.csv\")\n```\n\n\n\n--------------------------------------------------------------------------------\n\n\n### Songs on TikTok on both the Billboard and Spotify Charts\n\nWhat songs were popoular on TikTok that also appeared on both the Spotify and Billboard charts? \n\n::: panel-tabset\n\n#### R\n\nBy excluding the NA values, this gives a dataframe of eleven songs that appear on all three charts.\n\n```{r songs on all charts}\n# make a new dataframe with popular songs on TikTok that also appear on other charts\nsongs_on_all_charts <- combined_cleaned[complete.cases(combined_cleaned[ , c('rank_s', 'rank_t', 'rank_b')]), ]\n```\n\n```{r songs on all charts table}\n# make the table look nice\ngt(songs_on_all_charts) |>\n  tab_header(\n    title=\"Popular Songs on TikTok appearing on Other Charts\"\n  )\n```\n\n#### SQL\n\nThis is essentially the same as the R version -- excluding null values results in the songs that appeared on all charts. \n\n```{sql}\n#| connection: con\nSELECT *,\nFROM combined_cleaned\nWHERE rank_s IS NOT NULL \n  AND rank_t IS NOT NULL \n  AND rank_b IS NOT NULL\n```\n\n#### Python\n\nAgain, this excludes the null values. \n\n```{python}\nall_charts = combined[combined[['rank_s', 'rank_t', 'rank_b']].notnull().all(1)]\n\nGT(all_charts) # makes the table look nice\n```\n\n:::\n\n### Songs Appearing on Charts\n\nHow many songs appeared on all three charts? How many on just TikTok and Spotify? How many on just Billboard and Spotify? etc.\n\n::: panel-tabset\n\n#### R\n\nTo calculate these values, we first created new columns (one for each chart) that held either TRUE or FALSE depending on whether the song appeared on the corresponding chart. These new columns allowed us to use the summarize function to calculate how many true values appeared in each combination of columns. The results count how many songs appear on the various combinations of charts.\n\n```{r}\ncombined_cleaned |>\n  mutate( #create new columns that identify whether a song appears on the chart using TRUE/FALSE\n    on_tiktok = !is.na(rank_t), #identifies the non-NA songs appearing on the tiktok chart\n    on_spotify = !is.na(rank_s), #identifies the non-NA songs appearing on the spotify\n    on_billboard = !is.na(rank_b) #identifies the non-NA songs appearing on the billboard chart\n  ) |>\n  summarize( #calculates the total number of TRUE values for each combination of charts\n    only_tiktok = sum(on_tiktok & !on_spotify & !on_billboard),\n    only_spotify = sum(!on_tiktok & on_spotify & !on_billboard),\n    only_billboard = sum(!on_tiktok & !on_spotify & on_billboard),\n    only_tiktok_and_spotify = sum(on_tiktok & on_spotify & !on_billboard),\n    only_tiktok_and_billboard = sum(on_tiktok & !on_spotify & on_billboard),\n    only_spotify_and_billboard = sum(!on_tiktok & on_spotify & on_billboard),\n    all_three = sum(on_tiktok & on_spotify & on_billboard)\n  )\n```\n\n#### SQL w/ Pivot\n\nWe came up with two different methods to find the answer. The first uses CTEs and pivots to calculate the counts.\n\n```{sql totals with pivot}\n#| connection: con\nCREATE OR REPLACE TABLE total_counts_with AS\nWITH cte_1 AS(\n-- unpivot the table to make it longer\n  UNPIVOT combined_cleaned\n    ON rank_s, rank_t, rank_b\n    INTO\n      NAME charts\n      VALUE rank\n), cte_2 AS(\n-- the value in the rank column does not matter for this analysis, so we did not include it in SELECT\n  SELECT song_title, artist, charts, tempo\n  FROM cte_1\n), cte_3 AS(\n-- pivot to make the table wider\n  PIVOT_WIDER cte_2\n  ON charts\n  USING first(charts)\n), cte_4 AS(\n-- concatenate the three charts into one column\n  SELECT CONCAT(rank_s, ', ', rank_t, ', ', rank_b) AS charts\n  FROM cte_3\n)\n-- group by the new charts column and count how many songs appear on each combination of charts\n  SELECT charts, COUNT(*) AS counts\n  FROM cte_4\n  GROUP BY charts\n```\n\n#### SQL w/ Filter\n\nThe second method uses COUNT(*), FILTER, and WHERE. Each line counts the number of rows that meet the condition in WHERE.\n\n```{sql totals with filter}\n#| connection: con\nCREATE OR REPLACE TABLE total_counts AS\nSELECT COUNT(*) FILTER (WHERE rank_s IS NOT NULL AND rank_t IS NULL AND rank_b IS NULL) AS only_s,\n       COUNT(*) FILTER (WHERE rank_s IS NULL AND rank_t IS NOT NULL AND rank_b IS NULL) AS only_t,\n       COUNT(*) FILTER (WHERE rank_s IS NULL AND rank_t IS NULL AND rank_b IS NOT NULL) AS only_b,\n       COUNT(*) FILTER (WHERE rank_s IS NOT NULL AND rank_t IS NOT NULL AND rank_b IS NULL) AS only_spotify_and_tiktok,\n       COUNT(*) FILTER (WHERE rank_s IS NULL AND rank_t IS NOT NULL AND rank_b IS NOT NULL) AS only_tiktok_and_billboard,\n       COUNT(*) FILTER (WHERE rank_s IS NOT NULL AND rank_t IS NULL AND rank_b IS NOT NULL) AS only_spotify_and_billboard,\n       COUNT(*) FILTER (WHERE rank_s IS NOT NULL AND rank_t IS NOT NULL AND rank_b IS NOT NULL) AS all_three\nFROM combined_cleaned\n```\n\n#### Python\n\nTo create the output, we created a new dataframe with the labels as column headers and all the values set to zero. The we replaced each of the zeros with the appropriate counts. We used .sum() to count the non NA values for each column.\n\n```{python}\n(combined.\n  melt(id_vars = [\"song_title\"], var_name = \"charts\", value_name = \"rank\")\n)\n```\n\n\n```{python}\ndata = {'only_spotify': [0], 'only_tiktok': [0], 'only_billboard': [0], 'only_spotify_and_tiktok': [0], 'only_tiktok_and_billboard': [0], 'only_spotify_and_billboard': [0], 'all_three': [0]}\ntotals = pd.DataFrame(data)\n\ntotals['only_spotify'] = [(combined['rank_s'].notna() &\n                           combined['rank_t'].isna() &\n                           combined['rank_b'].isna()).sum()]\ntotals['only_tiktok'] = [(combined['rank_s'].isna() &\n                          combined['rank_t'].notna() &\n                          combined['rank_b'].isna()).sum()]\ntotals['only_billboard'] = [(combined['rank_s'].isna() &\n                             combined['rank_t'].isna() &\n                             combined['rank_b'].notna()).sum()]\ntotals['only_spotify_and_tiktok'] = [(combined['rank_s'].notna() &\n                                      combined['rank_t'].notna() &\n                                      combined['rank_b'].isna()).sum()]\ntotals['only_tiktok_and_billboard'] = [(combined['rank_s'].isna() &\n                                        combined['rank_t'].notna() &\n                                        combined['rank_b'].notna()).sum()]\ntotals['only_spotify_and_billboard'] = [(combined['rank_s'].notna() &\n                                         combined['rank_t'].isna() &\n                                         combined['rank_b'].notna()).sum()]\ntotals['all_three'] = [(combined['rank_s'].notna() &\n                        combined['rank_t'].notna() &\n                        combined['rank_b'].notna()).sum()]\n\nGT(totals)\n```\n\n:::\n\n### TikTok Songs and Tempo\n\nDid popular songs on TikTok have higher tempos? Many viral trends on TikTok involve creators doing a short dance. We wonder if there is a relationship to the tempo of songs and what which songs are popular. We used a simple scatter plot to visualize the data.\n\n::: panel-tabset\n\n#### R\n```{r warning=FALSE}\ncombined_cleaned |>\n  ggplot(data = combined_cleaned, mapping = aes(x = rank_t, y = tempo)) +\n  geom_point() +\n  labs(x = \"Song Rank on TikTok\", y = \"Tempo of Song\")\n```\n\n#### SQL\n\nNothing here since SQL doesn't visualize.\n\n#### Python\n\n```{python}\ncombined.plot.scatter(x=\"rank_t\", y=\"tempo\").set(xlabel=\"Rank on TikTok\", ylabel=\"Tempo (BPM)\", title=\"Tempo of Popular Songs on TikTok\")\n```\n\nAs seen from the plot, there does not appear to be a correlation between songs being popular on TikTok and tempo. In the original data, some of the songs had a rank of 0. The documentation does not describe why that some songs included in the chart have a rank of 0.\n\n:::\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":false,"eval":true,"cache":true,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","self-contained":true,"output-file":"analysis.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","theme":"cosmo","code_folding":"hide","code_summary":"Show the code"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}